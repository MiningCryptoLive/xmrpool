package blocktemplate

import (
	"bytes"
	"encoding/hex"
	"fmt"
	"io"
	"testing"
)

func TestBlockTemplateBlob_Pack_UnPack(t *testing.T) {
	blkTplBlobBytes, _ := hex.DecodeString("0e0eaed588840682dbba38bcf57bd78890057228be34a3b9115196f13a657228e53d05ee9a139f00000000028d938f0101ffd1928f01018bfef5f2e01e021944aa4583c1391a8613da7541f46fa98f3af5497f9b7b4326f6fa65542539b42501bfe3409fa63317d985b54cb5bea119d9a616e075c4da4434122b7bcb7f7b21f2020200000021c456003efc5fe6e092317280b61db6e6dad76d4b6065ca6a41dd1e854ce1fbe2872b088cdbedec0f75e58ba6a5316c17297d3fb16a4ff2a7987068b423a32c233ddedf317dea55b0357193eb5265539ffeb6e1fb84692f26e604a9b14d3cc313f34b943f535f7a9d1e783a3c2fc49f22f02e41b0c8bb15a3b85ce0904c33178b5d784d81fe9f442c80b337132fe174612fce7e856bd846175a9c6d93dde48cc272768dd7a24e584e5c99fc3a2b637d70d8ae05582a9810d54e1e3984bb15ec3c667180e9e39aed36ade5ee8114629e2c7d042a6616c03680e34ac443ee85ccd8aba9375dc31d3042f7e7ed8be9cf32144acbccc3f6161c69d31171e349bbc24bb39ccd382d161afd4819d4fdb414069eeafd4528414d0d2e3a3f54de43bb9e7578877fc6557cc407d4d951b91137bf58d270cfd94daed4e8d2311d38b91136d8caa492ebe28b2dd68aa29c635d1e2ae6ef618a4b5704b22e5f771128357d57495509600c647ad377c3fc1e6ceed44c16f13c4bcd17f962036380d7322c50d2643f5ce039e72a381189e9fec00f5bd913c939dd0e56503e712aff681b6790132ee3cc66c74535640952cc9247af9e9590dc396869d8fe547a0fbad619d714d02268dbe9e65e68136e3d55eb309b373a50b0b91866383efc0ce386fe22c153690fd6c4fff34cabc3bb4bf50c1d3a9cb8ca3a4a65040ff36423d752d1c750cdf139912de24fe8e87597b886c085a005d8af9fd12eb0060e6e520a5c36e2a72e40f06fbf4b271a72c689b9d39c1d5f2603974524620d21f4157eefbe4c99454a7a33207a717be5f6ca19ec5eb31e70c6a3ff80fc3a6968fe0e3275c2ce7642ebd2cc2062090b8e2bf120089a90e2f4666acfe9d5ff8f9c72f3e29f0be0e34bc933b5ea329b0d471b15423f21a6430a4dedf976de32fcef74b2dc297b33bbca0e323736addead03f7bfd9f8834bb44bfd51e1a9e4a67462be81019e9ee97abdb0bdff749368c79f8874b52cf15b483916757062561b12778948d513fd2aa7a90d89846d8424cda47e90897e3e2c5e75503c288847cc1f57802bee6ef3a8d8366176d6787cf765f848bef490ad732545d10256bc43ec1e8b83b53ac12695373a1ca07aa90ba540bf0587aa632543d640ba5496c848c4ec203602389197a91a038cc02ca26c322ce014dda5190b56497040e2465e9c5c0e9e02be58c78c7076b7854c81761a1bae6b97b6923ce4ca44b4ae2ff5cb2708d4202d7bd74a4883af60db92e5c46fc10830d9e599111e39873abde9362b44ead85e19db70a0ca91097daac1b89b68c056c7f965df49913c9bbaee0542554afcf339b49079b2c99b8ba6efa9a56f4672ed02f7bdb7384d4953bf219f5b4018cd2f4fb67fa7e01d910d432c44bf39f4bf30b035e5078d588a2e1ab1447d13c1f41b1c4493d1ae476721f3dd621038df916b270f77fbe7b1d828c266469b049faa731c79cabe82b155daad5701ca")
	bytesBuf := bytes.NewBuffer(blkTplBlobBytes)
	bufReader := io.Reader(bytesBuf)
	var blkTplBlob BlockTemplateBlob
	_ = blkTplBlob.UnPack(bufReader)
	voutCnt := len(blkTplBlob.Block.MinerTx.Vout)
	fmt.Println("vout count:", voutCnt)
	if voutCnt > 0 {
		fmt.Println("block reward:", blkTplBlob.Block.MinerTx.Vout[0].Amount)
	}
	fmt.Println("tx hash count:", len(blkTplBlob.Block.TxHashes))

	bytesBuf = bytes.NewBuffer([]byte{})
	bufWriter := io.Writer(bytesBuf)
	_ = blkTplBlob.Pack(bufWriter)
	fmt.Println("block template blob hex:", hex.EncodeToString(bytesBuf.Bytes()))
}
